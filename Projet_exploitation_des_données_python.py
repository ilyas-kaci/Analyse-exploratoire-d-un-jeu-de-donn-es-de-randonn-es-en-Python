import json
import pandas as pd
import matplotlib.pyplot as plt

# chargement du fichier Json
f = open(r'C:\Users\admin\Documents\Python TD Data\jeu_donnes_TD_1_2_python.json','r')
j_data = json.load(f)

# Extraction des éléments utiles
var = j_data['fields']
randonnees = j_data['values']

# Transformation du fichier Json en Tableau de données exploitable

tableau_rando = pd.DataFrame.from_dict(randonnees)

# connaissance des dimensions de notre data frame

print(f"Dimensions de notre tableau de données{tableau_rando.shape}")

# connaissance des colonnes de notre data frame

print(tableau_rando.columns)

# connaissance des types colonnes de notre data frame

print(tableau_rando.dtypes)

# localisation des valeurs None / Vide dans les colonnes contenant des nombres entier

print(tableau_rando.loc[tableau_rando['code_insee'].isna() | tableau_rando['gid'].isna(),['nom', 'gid', 'code_insee']])

# Nettoyage des données et attribution des bon types a chaque colonne
for nom_col in tableau_rando.columns :
    val = tableau_rando[nom_col].iloc[0]
    if tableau_rando[nom_col].dtype == object and val is not None and str(val[0]).isdigit() :
        tableau_rando[nom_col] = tableau_rando[nom_col].str.replace(r'[A-Za-z ]', '', regex=True)
        tableau_rando[nom_col] = tableau_rando[nom_col].str.replace(',', '.', regex=False)
        contient_point = tableau_rando[nom_col].head(10).str.contains('.',regex = False).any()
        if contient_point :
            tableau_rando[nom_col] = tableau_rando[nom_col].astype('float64')
        else :
            tableau_rando[nom_col] = tableau_rando[nom_col].fillna(0).astype('int64')


# Vérification du nettoyage
print(tableau_rando['longueur'])
print(tableau_rando['denivele'])
print(tableau_rando["temps_parcours"])
print(tableau_rando['code_insee'])
print(tableau_rando.dtypes)

# on commence les requettes et visualisations

# ici on cherche le temps de parcours moyen par niveau de difficulté
tpmpnd = tableau_rando.groupby('difficulte')['temps_parcours'].mean()
print(tpmpnd)
tpmpnd.plot.bar(title='temps de parcours moyen par niveau de difficulté')
plt.xlabel('niveau de difficulté')
plt.ylabel('temps moyen par minute')
plt.subplots_adjust(bottom=0.2)
plt.show()

# ici on cherche le nombre de randonnées pour chaque niveau de difficulté
nrpnd = tableau_rando.groupby('difficulte')['nom'].count()
nrpnd.plot.bar(title='le nombre de randonnées pour chaque niveau de difficulté',color = 'orange')
plt.xlabel('niveau de difficulté')
plt.ylabel('nombre de randonnées')
plt.subplots_adjust(bottom=0.2)
plt.show()


# repartition des randonnées par vocation :

rrv = tableau_rando.groupby('vocation')['nom'].count()
rrv.plot.pie(autopct='%1.1f%%',ylabel="",title="Répartition des randonnées par vocation")
plt.show()

# le temps de parcours en fonction du dénivelé

tableau_rando.plot.scatter(x='denivele', y='temps_parcours', title='le temps de parcours en fonction du dénivelé',color='red')
plt.xlabel('dénivelé en mètre ')
plt.ylabel('temps de parcours en minute')
plt.show()

# calcul du facteur de corrélation

R1 = tableau_rando['denivele'].corr(tableau_rando['temps_parcours'])
print(f"le facteur de corrélation entre le temps de parcours et le dénivelé est de {R1}")

# le temps de parcours en fonction de la longueur du parcours

tableau_rando.plot.scatter(x='longueur', y='temps_parcours', title='le temps de parcours en fonction de la longueur du parcours',color='green')
plt.xlabel('longueur en Km')
plt.ylabel('temps de parcours en minute')
plt.show()

# calcul du facteur de corrélation

R2 = tableau_rando['longueur'].corr(tableau_rando['temps_parcours'])
print(f"le facteur de corrélation entre le temps de parcours et la longueur est de {R2}")






